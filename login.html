<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>Cookie/Token å‚³è¼¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- éŸ¿æ‡‰å¼ -->

    <!--   external style sheets, bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
  
  <link rel="stylesheet" type="text/css" href="./login/login.css"> 
  <link rel="stylesheet" type="text/css" href="./aside.css"> 
  


</head>
<body>

  <div class="main_container">

    <div id="sidebar-container"></div>

      <!-- ä½¿ç”¨jså‘¼å«sidebar -->
      <script>
          fetch("./aside.html")
              .then(response => response.text())
              .then(data => {
              document.getElementById("sidebar-container").innerHTML = data;
              });
      </script>

  

  <div id="login_container" class="content_container">

    <h2>è¼¸å…¥ Synology ç™»å…¥è³‡è¨Š</h2>
    <form id="loginForm">
      <label>
        Cookie String:
        <textarea name="cookie_str" id="cookie_str" required></textarea>
      </label>

      <label>
        Token:
        <input type="text" name="token" id="token" required />
      </label>

      <button type="submit">é€å‡º</button>
    </form>
    <div class="result" id="result"></div>

    <button type="button" id="importBtn">è¼‰å…¥è³‡æ–™åº«</button>
    <div class="result" id="importResult"></div>

    

    <script>

      // è©²è¡¨å–®è¼¸å…¥cookieåŠtokençš„åƒæ•¸ è‹¥æœªä¾†éœ€è¦æ“´å……ï¼Œå¯ä»¥åŠ å…¥synologyçš„å¸³è™Ÿèˆ‡å¯†ç¢¼

      document.getElementById("loginForm").addEventListener("submit", function(e) {
        e.preventDefault(); // é˜»æ­¢è¡¨å–®åŸå§‹é€å‡º

        

        const cookie_str = document.getElementById("cookie_str").value;
        const token = document.getElementById("token").value;

        // å…ˆé¡¯ç¤ºç­‰å¾…æç¤º
        document.getElementById("result").innerText = "æ­£åœ¨çˆ¬å–ç…§ç‰‡ä¸­ï¼Œè«‹ç¨å¾Œ...";

        // ä½¿ç”¨ fetch (æ¯”èˆŠçš„XMLHttpRequestæ›´ç°¡æ½”)
        fetch("login/request.php", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded"
          },
          body: `cookie_str=${encodeURIComponent(cookie_str)}&token=${encodeURIComponent(token)}`
        })
        .then(response => response.text())
        .then(data => {
          document.getElementById("result").innerText = data;
        })
        .catch(error => {
          document.getElementById("result").innerText = "éŒ¯èª¤ï¼š" + error;
        });
      });
    </script>

    <script>
    // è©²æ®µè½ç”¨æ–¼åŒ¯å…¥è³‡æ–™åº«ï¼ŒåŸ·è¡Œimport.phpï¼Œä¸¦å°‡çµæœé¡¯ç¤ºåœ¨é é¢ä¸Š
    // ç›£è½è¼‰å…¥è³‡æ–™åº«æŒ‰éˆ•
    document.getElementById("importBtn").addEventListener("click", function() {
      document.getElementById("importResult").innerText = "æ­£åœ¨åŒ¯å…¥è³‡æ–™åº«ï¼Œè«‹ç¨å€™...";

      fetch("login/import.php", { method: "POST" })
        .then(response => response.json()) // æ¥æ”¶ JSON
        .then(data => {
          // é¡¯ç¤ºçµæœ
          document.getElementById("importResult").innerText =
            `âœ… åŒ¯å…¥å®Œæˆï¼Œç›®å‰å…± ${data.total} ç­†è³‡æ–™\nâœ… æ›´æ–°å®Œæˆï¼Œæœ¬æ¬¡æ›´æ–° ${data.new} ç­†è³‡æ–™\nâœ… åˆªé™¤ ${data.deleted} ç­†è³‡æ–™\nğŸ•’ æœ€å¾Œæ›´æ–°æ™‚é–“ ${data.last_update_time}`;

          // å„²å­˜è®Šæ•¸ (å¯ä¾›å„€è¡¨æ¿ä½¿ç”¨)
          window.importStats = {
            total: data.total,
            updated: data.new
          };

          console.log("å„€è¡¨æ¿ç”¨è®Šæ•¸ï¼š", window.importStats);
        })
        .catch(error => {
          document.getElementById("importResult").innerText = "éŒ¯èª¤ï¼š" + error;
        });
    });
  </script>
  </div>
  </div>

</body>
</html>